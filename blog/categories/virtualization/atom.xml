<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Virtualization | Haxin Mainframes]]></title>
  <link href="http://bbarrows.github.com/blog/categories/virtualization/atom.xml" rel="self"/>
  <link href="http://bbarrows.github.com/"/>
  <updated>2014-09-11T17:04:08-07:00</updated>
  <id>http://bbarrows.github.com/</id>
  <author>
    <name><![CDATA[Brad Barrows]]></name>
    <email><![CDATA[bradleyb1537@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Installing Openstack via RDO on CentOS 6.5]]></title>
    <link href="http://bbarrows.github.com/blog/2014/09/10/Openstack-RDO-CentOS-Error/"/>
    <updated>2014-09-10T16:47:00-07:00</updated>
    <id>http://bbarrows.github.com/blog/2014/09/10/Openstack-RDO-CentOS-Error</id>
    <content type="html"><![CDATA[<h1>RDO Packstack failing to install Openstack</h1>

<h2>Today I needed to bring up a new &ldquo;all in one&rdquo; Openstack Virtual Machine</h2>

<p>I now work at a company called Virtustream. Here I am currently working on projects that require to me to run a few virtual machines at a time all on my poor little W530 Thinkpad laptop. The strain (or most likely the heat from me being an idiot and working from bed when sick which did not allow my laptop to breath well probably) on my laptop caused my HardDrive to crash.</p>

<p>Went to get to work in the morning and was greeted by my favorite:</p>

<pre><code>Cannot run anything, your filesystem is mounted read only, etc etc messages..
</code></pre>

<p>I have seen this a few times before. Replace my hard drive maybe 3 or 4 times already (I bought a laptop pad with ventilation in case I work from bed anymore). Anyhow I just upgraded to a SSD HD. I do not know how I ever worked without this thing.. It is such an upgrade.
So much faster.</p>

<p>Anyway, so what this whole blog post is really about is when I went to install my IceHouse Openstack All In One via RedHat&rsquo;s RDO PackStack, which is found at <a href="https://openstack.redhat.com/Quickstart">RDO PackStack Quick Install</a>. I ran through the simple directions like usual but the install failed. I even tried disabling SELinux by editing: /etc/selinux/config and setting:</p>

<pre><code>SELINUX=permissive
</code></pre>

<p> then restarting and installing. I tried it with a fresh VM then, re installed Cent OS 6.5. Nothing would work.</p>

<p> It kept dying at:</p>

<pre><code>192.168.122.166_nova.pp:                             [ DONE ]
Applying 192.168.122.166_neutron.pp
192.168.122.166_neutron.pp:                       [ ERROR ]
Applying Puppet manifests                         [ ERROR ]
</code></pre>

<p>The logs shows the following in red:</p>

<pre><code>Warning: Config file /etc/puppet/hiera.yaml not found, using Hiera defaults
Warning: Scope(Class[Neutron::Server]): The sql_connection parameter is deprecated, use database_connection instead.
Warning: Scope(Class[Neutron::Plugins::Ml2]): enable_security_group is deprecated. Security is managed by the firewall_drive value in ::neutron::agents::ml2::ovs.


Warning: The package type's allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.
   (at /usr/lib/ruby/site_ruby/1.8/puppet/type/package.rb:430:in `default')


Error: sysctl -p /etc/sysctl.conf returned 255 instead of one of [0]
Error: /Stage[main]/Packstack::Neutron::Bridge/Exec[sysctl_refresh]/returns: change from notrun to 0 failed: sysctl -p /etc/sysctl.conf returned 255 instead of one of [0]
</code></pre>

<p>Among a bunch of normal colored notices..</p>

<p>After googling for a while I found that someone had posted a bug and fix!!</p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?format=multiple&amp;id=1132129">Openstack PackStack CentOS 6.5 Install Patch</a></p>

<p>Looking through the patch for the fix I see that they just needed to add a -e parameter to sysctl to ignore some new keys added to /etc/sysctl.conf in CentOS 6.5</p>

<hr />

<p>Finally, the workaround. Well you do not need to re format/start form scratch like I did a few times. You can just go and edit:</p>

<pre><code>vim /usr/share/openstack-puppet/modules/packstack/manifests/neutron/bridge.pp
</code></pre>

<p>And then change the line:</p>

<pre><code>    command =&gt; 'sysctl -p /etc/sysctl.conf',
</code></pre>

<p>to:</p>

<pre><code>    command =&gt; 'sysctl -e -p /etc/sysctl.conf',
</code></pre>

<p>Note the new -e param. This ignores unknown keys so that no error will be returned, crashing the packstack install.</p>

<p>Then to continue your packstack install, you need to re run packstack but with your &ldquo;answer file&rdquo; which contains all the passwords and info needed from the partially complete install you just tried to do:</p>

<p>Run this via:</p>

<pre><code>packstack --answer-file=packstack-answers-20140910-111306.txt
</code></pre>

<p>NOTE: You answer file with have a different name/timestamp!</p>

<p>And after this your install should work!  Good luck!</p>
]]></content>
  </entry>
  
</feed>
