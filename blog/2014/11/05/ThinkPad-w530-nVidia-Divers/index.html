<pre><code>---
</code></pre>

<p>layout: post
title: &ldquo;Using nVidia Drivers on a Thinkpad w530&rdquo;
date: 2014-11-5 12:47
comments: true</p>

<h2>categories: [Ubuntu, Thinkpad, w530, nVidia, Drivers]</h2>

<h2>Drivers</h2>

<p>To get the nVidia Drivers working with a w530 laptop you must select the Discrete Video Driver in the BIOS.</p>

<p>Then run the following to install the ?latest? (using sudo apt-get install nvidia-current may be better) nvidia drivers:</p>

<pre><code>sudo add-apt-repository -y ppa:ubuntu-x-swat/x-updates; sudo apt-get update; sudo apt-get install nvidia-331
</code></pre>

<p>The driver install should automatically create a new xorg.conf but if not you can run:</p>

<pre><code>sudo nvidia-xconfig
</code></pre>

<p>Some people even chose to purge the previous integrated drivers:</p>

<pre><code>sudo apt-get purge xserver-xorg-video-nouveau
</code></pre>

<p>Add blacklist it from the kernel (if there is no blacklist-nouveau.conf in /etc/modprobe.d/ you can just create it):</p>

<pre><code>sudo vim /etc/modprobe.d/blacklist-nouveau.conf
</code></pre>

<p>Adding these lines:</p>

<pre><code>blacklist nouveau
blacklist lbm-nouveau
options nouveau modeset=0
alias nouveau off
alias lbm-nouveau off
</code></pre>

<p>(A StackOverflow post also shows another way)[<a href="http://askubuntu.com/questions/451221/ubuntu-14-04-install-nvidia-driver">http://askubuntu.com/questions/451221/ubuntu-14-04-install-nvidia-driver</a>] to disable/blacklist the driver:</p>

<pre><code>sudo echo options nouveau modeset=0 | sudo tee -a /etc/modprobe.d/nouveau-kms.conf
sudo update-initramfs -u
</code></pre>

<p>This worked great until I had a system update. I rebooted and my laptop was flashing, trying to “startx” but failing over and over, could not even switch to a terminal via ctr-alt-f1</p>

<p>It sounds like this can be fixed by (rebuilding with every kernel update)[<a href="http://askubuntu.com/questions/536562/ubuntu-14-04-with-nvidia-driver-blank-screen-after-kernel-update">http://askubuntu.com/questions/536562/ubuntu-14-04-with-nvidia-driver-blank-screen-after-kernel-update</a>]:</p>

<pre><code>sudo apt-get install dkms build-essential linux-headers-generic linux-headers-`uname -r` linux-source
</code></pre>

<p>It will install dkms and the headers before you run the installer and it should give you a DKMS option during setup. DKMS will prevent the problem you are experiencing so you don&rsquo;t have to re-install every kernel upgrade.</p>

<p>The issue is that every kernel upgrade the nVidia drivers are not rebuild/configured with the kernel upgrade..</p>

<h2>GRUB</h2>

<p>You will also need to update your boot loader, adding a boot option, nox2apic:</p>

<pre><code>sudo vim /etc/default/grub
</code></pre>

<p>and add the &ldquo;nox2apic&rdquo; flag to the GRUB_CMDLINE_LINUX option, or in my case it was the GRUB_CMDLINE_LINUX_DEFAULT. I would look for the variable with the nosplash option and add it to that one, I am sure it would not hurt to add nox2apic to both if you do have both the GRUB_CMDLINE_LINUX and GRUB_CMDLINE_LINUX_DEFAULT options in ur grub config.</p>

<p>You will be changing something like:
    GRUB_CMDLINE_LINUX_DEFAULT=&ldquo;quiet splash&rdquo;
to:
    GRUB_CMDLINE_LINUX_DEFAULT=&ldquo;quiet splash nox2apic&rdquo;</p>

<p>To update grub you will need to run:</p>

<pre><code>sudo update-grub
</code></pre>

<p><a href="http://blog.jordanengbers.com/2012/11/nvidia-optimus-and-multiple-monitors-in-ubunt/">This Site</a> has a breakdown on why this option in needed.</p>
